{"version":3,"file":"user.js","sources":["stores/user.js"],"sourcesContent":["import { defineStore } from 'pinia'\r\nimport request from '../utils/request'\r\n\r\nexport const userStore = defineStore('user', {\r\n    state: () => {\r\n        return { \r\n            count: 11,\r\n            token: '' \r\n        }\r\n    },\r\n    getters: {\r\n        getToken() {\r\n            return uni.getStorageSync('token')\r\n        },\r\n        user() {\r\n            return uni.getStorageSync('user')\r\n        }\r\n    },\r\n    actions: {\r\n        increment() {\r\n            this.count++\r\n        },\r\n        // 更新用户信息\r\n        userSetting(params) {\r\n            return new Promise((resolve, reject) => {\r\n                request.send({\r\n                    url: '/user/setting',\r\n                    method: 'POST',\r\n                    data: params,\r\n                    success: (res) => {\r\n                        resolve(res.data)\r\n                    },\r\n                    fail: (error) => {\r\n                        reject(error)\r\n                    }\r\n                })\r\n            })\r\n        },\r\n        // 微信小程序登录\r\n        wxLogin(params) {\r\n            return new Promise((resolve, reject) => {\r\n                request.send({\r\n                    url: '/wechat/login',\r\n                    method: 'POST',\r\n                    data: params,\r\n                    success: (res) => {\r\n                        uni.setStorageSync('token',  res.data.data.access_token)\r\n                        resolve(res.data)\r\n                    },\r\n                    fail: (error) => {\r\n                        reject(error)\r\n                    }\r\n                })\r\n            })\r\n        },\r\n        // 获取用户信息\r\n        userInfo(params) {\r\n            return new Promise((resolve, reject) => {\r\n                request.send({\r\n                    url: '/user/info',\r\n                    method: 'GET',\r\n                    data: params,\r\n                    success: (res) => {\r\n                        uni.setStorageSync('user',  res.data.data)\r\n                        resolve(res.data)\r\n                    },\r\n                    fail: (error) => {\r\n                        reject(error)\r\n                    }\r\n                })\r\n            })\r\n        },\r\n        // 退出登录\r\n        logout() {\r\n            try {\r\n                uni.removeStorageSync('token')\r\n                uni.removeStorageSync('user')\r\n                uni.removeStorageSync('searchHistoryKeywords')\r\n                uni.clearStorageSync()\r\n                uni.reLaunch({\r\n                    url: '/pages/auth/login'\r\n                });\r\n            } catch (e) {\r\n                console.log(e)\r\n            }\r\n        }\r\n\r\n    },\r\n})"],"names":["defineStore","uni","request"],"mappings":";;;AAGY,MAAC,YAAYA,cAAW,YAAC,QAAQ;AAAA,EACzC,OAAO,MAAM;AACT,WAAO;AAAA,MACH,OAAO;AAAA,MACP,OAAO;AAAA,IACV;AAAA,EACJ;AAAA,EACD,SAAS;AAAA,IACL,WAAW;AACP,aAAOC,cAAG,MAAC,eAAe,OAAO;AAAA,IACpC;AAAA,IACD,OAAO;AACH,aAAOA,cAAG,MAAC,eAAe,MAAM;AAAA,IACnC;AAAA,EACJ;AAAA,EACD,SAAS;AAAA,IACL,YAAY;AACR,WAAK;AAAA,IACR;AAAA;AAAA,IAED,YAAY,QAAQ;AAChB,aAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACpCC,sBAAAA,QAAQ,KAAK;AAAA,UACT,KAAK;AAAA,UACL,QAAQ;AAAA,UACR,MAAM;AAAA,UACN,SAAS,CAAC,QAAQ;AACd,oBAAQ,IAAI,IAAI;AAAA,UACnB;AAAA,UACD,MAAM,CAAC,UAAU;AACb,mBAAO,KAAK;AAAA,UACf;AAAA,QACrB,CAAiB;AAAA,MACjB,CAAa;AAAA,IACJ;AAAA;AAAA,IAED,QAAQ,QAAQ;AACZ,aAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACpCA,sBAAAA,QAAQ,KAAK;AAAA,UACT,KAAK;AAAA,UACL,QAAQ;AAAA,UACR,MAAM;AAAA,UACN,SAAS,CAAC,QAAQ;AACdD,0BAAG,MAAC,eAAe,SAAU,IAAI,KAAK,KAAK,YAAY;AACvD,oBAAQ,IAAI,IAAI;AAAA,UACnB;AAAA,UACD,MAAM,CAAC,UAAU;AACb,mBAAO,KAAK;AAAA,UACf;AAAA,QACrB,CAAiB;AAAA,MACjB,CAAa;AAAA,IACJ;AAAA;AAAA,IAED,SAAS,QAAQ;AACb,aAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACpCC,sBAAAA,QAAQ,KAAK;AAAA,UACT,KAAK;AAAA,UACL,QAAQ;AAAA,UACR,MAAM;AAAA,UACN,SAAS,CAAC,QAAQ;AACdD,0BAAAA,MAAI,eAAe,QAAS,IAAI,KAAK,IAAI;AACzC,oBAAQ,IAAI,IAAI;AAAA,UACnB;AAAA,UACD,MAAM,CAAC,UAAU;AACb,mBAAO,KAAK;AAAA,UACf;AAAA,QACrB,CAAiB;AAAA,MACjB,CAAa;AAAA,IACJ;AAAA;AAAA,IAED,SAAS;AACL,UAAI;AACAA,sBAAG,MAAC,kBAAkB,OAAO;AAC7BA,sBAAG,MAAC,kBAAkB,MAAM;AAC5BA,sBAAG,MAAC,kBAAkB,uBAAuB;AAC7CA,sBAAAA,MAAI,iBAAkB;AACtBA,sBAAAA,MAAI,SAAS;AAAA,UACT,KAAK;AAAA,QACzB,CAAiB;AAAA,MACJ,SAAQ,GAAG;AACRA,sBAAAA,MAAY,MAAA,OAAA,wBAAA,CAAC;AAAA,MAChB;AAAA,IACJ;AAAA,EAEJ;AACL,CAAC;;"}